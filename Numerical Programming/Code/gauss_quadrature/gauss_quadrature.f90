!================================================================================================
! COMPHY3_Gauss_Quadrature.f90
! Justin Gabrielle A. Manay
! COMPHY3, Physics Department, De La Salle University
! This program computes for the integral of a function using the Gauss quadrature rule.
!================================================================================================

program gauss_quad

    implicit none
    !--------------------------------------------------------------------------------------------
    ! Declare variables
    integer :: n = 10, i
    real*16 :: a = 1.0, b = 0.0, x_1, x_2, dist = 0.0, te, rte
    real*16, dimension(:), allocatable :: c, x
    !--------------------------------------------------------------------------------------------

    !--------------------------------------------------------------------------------------------
    ! Specify number of segments.
    do while(n > 6)
        write(*,*) "Please specify the number of points (up to 6 only)."
        write(*, "(a4, 1x)", advance = "no") "n = "
        read(*,*) n
    end do

    allocate(c(n))
    allocate(x(n))
    !--------------------------------------------------------------------------------------------

    !--------------------------------------------------------------------------------------------
    ! Specify values for a and b
    do while(b < a)
        write(*,*) "Please specify values for a and b, a <= b."
        write(*, "(a4, 1x)", advance = "no") "a = "
        read(*,*) a
        write(*, "(a4, 1x)", advance = "no") "b = "
        read(*,*) b
    end do
    !--------------------------------------------------------------------------------------------

    !--------------------------------------------------------------------------------------------
    ! Specify weights
    if(n == 2) then
        c = [1.0, 1.0]
        x = [-0.5773502691896257, 0.5773502691896257]
    else if(n == 3) then
        c = [0.8888888888888888, 0.5555555555555556, 0.5555555555555556]
        x = [0.0, -0.7745966692414834, 0.7745966692414834]
    else if(n == 4) then
        c = [0.6521451548625461, 0.6521451548625461, 0.3478548451374538, 0.3478548451374538]
        x = [-0.3399810435848563, 0.3399810435848563, -0.8611363115940526, 0.8611363115940526]
    else if(n == 5) then
        c = [0.5688888888888889, 0.4786286704993665, 0.4786286704993665, 0.2369268850561891, 0.2369268850561891]
        x = [0.0, -0.5384693101056831, 0.5384693101056831, -0.9061798459386640, 0.9061798459386640]
    else if(n == 6) then
        c = [0.3607615730481386, 0.3607615730481386, 0.4679139345726910, 0.4679139345726910, 0.1713244923791704, 0.1713244923791704]
        x = [0.6612093864662645, -0.6612093864662645, -0.2386191860831969, 0.2386191860831969, -0.9324695142031521, &
        0.9324695142031521]
    end if
    !--------------------------------------------------------------------------------------------

    !--------------------------------------------------------------------------------------------
    ! Normalize a and b
    x_1 = (b - a) / 2
    x_2 = (b + a) / 2

    !--------------------------------------------------------------------------------------------

    !--------------------------------------------------------------------------------------------
    ! Compute for integral.
    do i = 1, n
        dist = dist + c(i) * fx(x_1 * x(i) + x_2)
    end do

    dist = x_1 * dist

    write(*, "(a37, 1x, f20.10, 1x, a7)", advance = "no") "The distance covered by the rocket is", dist, "meters."
    write(*,*)

    te = (integ_fx(b) - integ_fx(a)) - dist
    rte = abs((dist - (integ_fx(b) - integ_fx(a))) / (integ_fx(b) - integ_fx(a))) * 100

    write(*,"(a17, 1x, f20.10)", advance = "no") "The true value is", integ_fx(b) - integ_fx(a)
    write(*,*)

    write(*,"(a17, 1x, f20.10)", advance = "no") "The true error is", te
    write(*,*)

    write(*,"(a26, 1x, f20.10, 1x, a2)", advance = "no") "The relative true error is", rte, "%."
    !--------------------------------------------------------------------------------------------

    contains
        function fx(a) result(fx_eval)
            !--------------------------------------------------------------------------------------------
            ! Declare variables
            real*16 :: a, fx_eval
            !--------------------------------------------------------------------------------------------

            !--------------------------------------------------------------------------------------------
            ! Specify function
            fx_eval = 2000 * log(140000/(140000 - 2100 * a)) - 9.8 * a
            !--------------------------------------------------------------------------------------------
        end function fx

        function integ_fx(a) result(integ_fx_eval)
            !--------------------------------------------------------------------------------------------
            ! Declare variables
            real*16 :: a, integ_fx_eval
            !--------------------------------------------------------------------------------------------

            !--------------------------------------------------------------------------------------------
            ! Specify function
            integ_fx_eval = (2000 * a - 133333) * log(66.6667 / (66.6667 - a)) + (2000 - 4.9 * a) * a
            !--------------------------------------------------------------------------------------------
        end function integ_fx

end program gauss_quad
